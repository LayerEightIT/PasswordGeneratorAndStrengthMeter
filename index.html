<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Password Generator and Strength Meter</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#06b6d4;
    --danger:#ef4444; --warn:#f59e0b; --good:#10b981; --glass: rgba(255,255,255,0.03);
  }
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:linear-gradient(180deg,#071022 0%,#071a2a 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;max-width:920px;width:100%;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
  .full{grid-column:1/-1}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  .pw-row{display:flex;gap:8px;align-items:center}
  input[type="text"], input[type="password"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:15px}
  button, .btn{background:var(--accent);color:#042027;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .meter{height:12px;border-radius:8px;background:rgba(255,255,255,0.04);overflow:hidden}
  .meter > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--danger),var(--warn),var(--good));transition:width .25s ease}
  .meta{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;color:var(--muted);font-size:13px}
  .controls{background:rgba(255,255,255,0.01);padding:12px;border-radius:10px}
  .row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  .toggle{display:flex;gap:8px;align-items:center}
  input[type="checkbox"]{width:18px;height:18px}
  .score-label{font-weight:700}
  .tips{margin-top:12px;color:var(--muted);font-size:13px}
  .footer{margin-top:12px;color:var(--muted);font-size:12px}
  @media (max-width:880px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<main class="card" aria-labelledby="title">
  <h2 id="title">Password Generator and Strength Meter</h2>
  <p class="small">Everything runs in your browser. Nothing is sent to any server.</p>

  <div class="grid" role="region" aria-label="Password tool">
    <section>
      <div class="full">
        <label for="pw">Password</label>
        <div class="pw-row">
          <input id="pw" type="text" inputmode="text" aria-describedby="strengthDesc" autocomplete="off" placeholder="Type or generate a password" />
          <button id="toggleShow" class="btn-ghost" aria-pressed="false" title="Show or hide password">Show</button>
          <button id="copyBtn" class="btn" title="Copy password">Copy</button>
        </div>

        <div style="margin-top:12px">
          <div class="meter" aria-hidden="true"><i id="meterBar"></i></div>
          <div class="meta" id="strengthDesc" aria-live="polite">
            <div><span class="score-label" id="scoreLabel">—</span></div>
            <div id="entropyLabel">Entropy: 0 bits</div>
            <div id="crackLabel">Crack time: —</div>
          </div>
        </div>

        <div class="tips">
          <strong>Tip</strong> Use a passphrase of multiple random words for memorability, or a long random string for maximum entropy.
        </div>
      </div>
    </section>

    <aside class="controls" aria-labelledby="generatorTitle">
      <h3 id="generatorTitle" style="margin-top:0">Generator</h3>

      <div class="row">
        <label for="length" class="small">Length <span id="lenVal">16</span></label>
        <input id="length" type="range" min="8" max="64" value="16" />
      </div>

      <div style="margin-bottom:8px">
        <div class="toggle"><input id="lower" type="checkbox" checked /><label for="lower" class="small">Lowercase</label></div>
        <div class="toggle"><input id="upper" type="checkbox" checked /><label for="upper" class="small">Uppercase</label></div>
        <div class="toggle"><input id="numbers" type="checkbox" checked /><label for="numbers" class="small">Numbers</label></div>
        <div class="toggle"><input id="symbols" type="checkbox" /><label for="symbols" class="small">Symbols</label></div>
        <div class="toggle"><input id="avoidAmbiguous" type="checkbox" /><label for="avoidAmbiguous" class="small">Avoid ambiguous chars (0 O l 1)</label></div>
      </div>

      <div style="display:flex;gap:8px">
        <button id="generateBtn" class="btn">Generate</button>
        <button id="regenBtn" class="btn-ghost">Regenerate</button>
      </div>

      <div class="footer">
        <div style="margin-top:8px">Scoring engine: <span id="engineLabel">zxcvbn (loading)</span></div>
      </div>
    </aside>
  </div>
</main>

<script>
const pwInput = document.getElementById('pw');
const meterBar = document.getElementById('meterBar');
const scoreLabel = document.getElementById('scoreLabel');
const entropyLabel = document.getElementById('entropyLabel');
const crackLabel = document.getElementById('crackLabel');
const copyBtn = document.getElementById('copyBtn');
const toggleShow = document.getElementById('toggleShow');
const lengthRange = document.getElementById('length');
const lenVal = document.getElementById('lenVal');
const generateBtn = document.getElementById('generateBtn');
const regenBtn = document.getElementById('regenBtn');
const engineLabel = document.getElementById('engineLabel');

let zxcvbnLoaded = false;
let zxcvbnLoading = false;
let lastGenerated = '';

const CDN = 'https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js';

function loadZxcvbn(){
  if(zxcvbnLoaded || zxcvbnLoading) return;
  zxcvbnLoading = true;
  const s = document.createElement('script');
  s.src = CDN;
  s.crossOrigin = 'anonymous';
  s.onload = () => { zxcvbnLoaded = true; zxcvbnLoading = false; engineLabel.textContent = 'zxcvbn'; evaluatePassword(); };
  s.onerror = () => { zxcvbnLoaded = false; zxcvbnLoading = false; engineLabel.textContent = 'entropy fallback'; evaluatePassword(); };
  document.head.appendChild(s);
}

function secureRandomInt(n){
  const arr = new Uint32Array(1);
  crypto.getRandomValues(arr);
  return Math.floor((arr[0] / 2**32) * n);
}

function buildCharset(opts){
  const sets = {
    lower: 'abcdefghijklmnopqrstuvwxyz',
    upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    numbers: '0123456789',
    symbols: '!@#$%^&*()-_=+[]{};:,.<>/?'
  };
  let chars = '';
  if(opts.lower) chars += sets.lower;
  if(opts.upper) chars += sets.upper;
  if(opts.numbers) chars += sets.numbers;
  if(opts.symbols) chars += sets.symbols;
  if(opts.avoidAmbiguous){
    chars = chars.replace(/[O0Il1]/g,'');
  }
  return chars;
}

function generatePassword(){
  const length = parseInt(lengthRange.value,10);
  const opts = {
    lower: document.getElementById('lower').checked,
    upper: document.getElementById('upper').checked,
    numbers: document.getElementById('numbers').checked,
    symbols: document.getElementById('symbols').checked,
    avoidAmbiguous: document.getElementById('avoidAmbiguous').checked
  };
  const charset = buildCharset(opts);
  if(!charset.length){
    alert('Select at least one character set.');
    return '';
  }
  let out = '';
  for(let i=0;i<length;i++){
    out += charset[secureRandomInt(charset.length)];
  }
  lastGenerated = out;
  return out;
}

function entropyBits(password, charsetSize){
  if(!password) return 0;
  return password.length * Math.log2(charsetSize || 1);
}

function humanTime(seconds){
  if(!isFinite(seconds) || seconds <= 0) return 'Instant';
  const units = [
    {label:'years', val:60*60*24*365},
    {label:'days', val:60*60*24},
    {label:'hours', val:60*60},
    {label:'minutes', val:60},
    {label:'seconds', val:1}
  ];
  for(const u of units){
    if(seconds >= u.val){
      const v = Math.floor(seconds / u.val);
      return `${v} ${u.label}`;
    }
  }
  return 'less than a second';
}

function evaluatePassword(){
  const pw = pwInput.value || '';

  if (!pw) {
    updateUI(-1, 0, 0);
    engineLabel.textContent = zxcvbnLoaded ? 'zxcvbn' : 'entropy fallback';
    return;
  }

  if(zxcvbnLoaded && typeof window.zxcvbn === 'function'){
    try{
      const res = window.zxcvbn(pw);
      const score = res.score;
      const guesses = res.guesses;
      const entropy = res.entropy;
      updateUI(score, entropy, guesses);
      engineLabel.textContent = 'zxcvbn';
      return;
    }catch(e){}
  }

  let charsetSize = 0;
  if(/[a-z]/.test(pw)) charsetSize += 26;
  if(/[A-Z]/.test(pw)) charsetSize += 26;
  if(/[0-9]/.test(pw)) charsetSize += 10;
  if(/[^A-Za-z0-9]/.test(pw)) charsetSize += 32;

  if(charsetSize === 0) charsetSize = 1;

  const bits = entropyBits(pw, charsetSize);
  const guesses = Math.pow(2, bits);
  const score = bits < 28 ? 0 : bits < 36 ? 1 : bits < 60 ? 2 : bits < 80 ? 3 : 4;

  updateUI(score, bits, guesses);
  engineLabel.textContent = 'entropy fallback';
}

function updateUI(score, bits, guesses){
  if (score < 0) {
    meterBar.style.width = '0%';
    scoreLabel.textContent = '—';
    entropyLabel.textContent = 'Entropy: 0 bits';
    crackLabel.textContent = 'Crack time: —';
    return;
  }

  const pct = ((score + 1) / 5) * 100;
  meterBar.style.width = pct + '%';

  const labels = ['Very weak','Weak','Fair','Strong','Excellent'];
  scoreLabel.textContent = labels[Math.max(0, Math.min(4, score))];
  entropyLabel.textContent = 'Entropy: ' + Math.round(bits) + ' bits';

  const guessesPerSec = 1e10;
  const seconds = guesses / guessesPerSec;
  crackLabel.textContent = 'Crack time: ' + humanTime(seconds);
}

pwInput.addEventListener('input', () => { evaluatePassword(); loadZxcvbn(); });
pwInput.addEventListener('focus', loadZxcvbn);
lengthRange.addEventListener('input', () => { lenVal.textContent = lengthRange.value; });

generateBtn.addEventListener('click', () => {
  const pw = generatePassword();
  if(pw){
    pwInput.value = pw;
    evaluatePassword();
  }
});

regenBtn.addEventListener('click', () => {
  const pw = generatePassword();
  if(pw){
    pwInput.value = pw;
    evaluatePassword();
  }
});

copyBtn.addEventListener('click', async () => {
  const val = pwInput.value;
  if(!val){ alert('Nothing to copy'); return; }
  try{
    await navigator.clipboard.writeText(val);
    copyBtn.textContent = 'Copied';
    setTimeout(()=> copyBtn.textContent = 'Copy', 1500);
  }catch(e){
    alert('Copy failed. Select and copy manually.');
  }
});

toggleShow.addEventListener('click', () => {
  const isShown = toggleShow.getAttribute('aria-pressed') === 'true';
  toggleShow.setAttribute('aria-pressed', String(!isShown));
  toggleShow.textContent = isShown ? 'Show' : 'Hide';
  pwInput.type = 'text';
});

evaluatePassword();

document.addEventListener('keydown', (e) => {
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'g'){
    e.preventDefault();
    generateBtn.click();
  }
});
</script>
</body>
</html>
